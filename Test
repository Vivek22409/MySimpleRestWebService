package com.cg.test;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import javax.jcr.NodeIterator;
import javax.jcr.Repository;
import javax.jcr.Session;
import javax.jcr.SimpleCredentials;
import javax.jcr.Node;
import org.apache.jackrabbit.commons.JcrUtils;


public class Test {
	public static void main(String args[]){
		createNodes();
		//readNodes();
		//updateNodes();		
		//deleteNodes();
	}
	public static void deleteNodes(){
		Repository repository = null;
		//String path = "/content/dam/Sample";
		String repositoryURL= "http://localhost:4502/crx/server";
		try { 
			//Create a connection to the CQ repository running on local host 
			repository = JcrUtils.getRepository(repositoryURL);
			//Create a Session
			javax.jcr.Session session = repository.login( new SimpleCredentials("admin", "admin".toCharArray())); 
			//Create a node that represents the root node			
			Node root = session.getRootNode();		
			Node tenantsNode = root.getNode("content/dam/Sample/Tenants");

			//Retrieve content 			
			NodeIterator nodeItr = tenantsNode.getNodes();
			while (nodeItr.hasNext()){
				Node tenant = nodeItr.nextNode();
				tenant.remove();
			}
			//Save the session changes and log out
			session.save(); 
			session.logout();
			System.out.println("All the nodes deleted successfully!");
		}
		catch(Exception e){
			e.printStackTrace();
		}
	}
	
	public static void readNodes(){
		Repository repository = null;
		//String path = "/content/dam/Sample";
		String repositoryURL= "http://localhost:4502/crx/server";
		try { 
			//Create a connection to the CQ repository running on local host 
			repository = JcrUtils.getRepository(repositoryURL);

			//Create a Session
			javax.jcr.Session session = repository.login( new SimpleCredentials("admin", "admin".toCharArray())); 

			//Create a node that represents the root node			
			Node root = session.getRootNode();
			Node tenantsNode = root.getNode("content/dam/009/Tenants");

			//Retrieve content 
			NodeIterator nodeItr = tenantsNode.getNodes();
			while (nodeItr.hasNext()){
				Node tenant = nodeItr.nextNode();
				if(tenant.getProperty("Name").getString()!=null)
					System.out.println("Id: "+tenant.getProperty("Id").getString()+" Name: "+tenant.getProperty("Name").getString());
			}		

			//Save the session changes and log out
			session.save(); 
			session.logout();
			System.out.println("Done successfully!");
		}
		catch(Exception e){
			e.printStackTrace();
		}
	}
	
	public static void createNodes(){
		int counter = 1;
		Repository repository = null;
		List<Tenant> tenantList = new ArrayList<Tenant>();
		//String path = "/content/dam/Sample";
		String repositoryURL= "http://localhost:4502/crx/server";
		try { 
			//Create a connection to the CQ repository running on local host 
			repository = JcrUtils.getRepository(repositoryURL);
			//Create a Session
			javax.jcr.Session session = repository.login( new SimpleCredentials("admin", "admin".toCharArray())); 
			//Create a node that represents the root node			
			Node root = session.getRootNode(); 

			tenantList.add(new Tenant(100,"Vinod"));
			tenantList.add(new Tenant(101,"Rahul"));
			tenantList.add(new Tenant(102,"Akshay"));
			tenantList.add(new Tenant(103,"Romit"));
			tenantList.add(new Tenant(104,"Pawan"));

			Iterator<Tenant> itr = tenantList.iterator();

			// Store content 
			//Node employees = root.addNode("Employees"); 
			Node tenantsNode = root.getNode("content/dam/Sample"); 
			while(itr.hasNext()){
				Tenant tenant = itr.next();
				Node tenantNode = tenantsNode.addNode("Tenant"+counter++);
				tenantNode.setProperty("Id", tenant.getId());
				tenantNode.setProperty("Name", tenant.getName());	

			}		

			// Save the session changes and log out
			session.save(); 
			session.logout();
			System.out.println("All the nodes creadted successfully!");
		}
		catch(Exception e){
			e.printStackTrace();
		}
	}
	public static void  updateNodes(){
		//String fileName = "/content/dam/Sample/Desert.jpg", owner="Vivek", lastModified, assetType="Photo", projectId="1234",  createrTool="Demo", freeFormField="DAM 2.0";
		Repository repository = null;
		String repositoryURL= "http://localhost:4502/crx/server";

		try { 
			repository = JcrUtils.getRepository(repositoryURL);

			Session session = repository.login(new SimpleCredentials("admin", "admin".toCharArray()));			
			//Create a node that represents the root node			
			Node root = session.getRootNode(); 			


			// Store content 
			//Node employees = root.addNode("Employees"); 
			Node tenantsNode = root.getNode("content/dam/009/Tenants"); 

			Node tenantNode = tenantsNode.getNode("Tenant3");
			tenantNode.setProperty("Id", "117");
			tenantNode.setProperty("Name", "Sachin");
			
			Node tenantNode1 = tenantsNode.getNode("Tenant2");
			tenantNode.setProperty("Id", "116");
			tenantNode.setProperty("Name", "Mandeep");


			session.save(); 
			System.out.println("Updated Successfully");
		}
		catch(Exception e){
			e.printStackTrace();
		} 		
	}

}
